<?xml version="1.0"?>
<view:ViewBase xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:view="dittner.gsa.view.common.view.*"
               xmlns:toolbar="dittner.gsa.view.fileList.toolbar.*"
               xmlns:form="dittner.gsa.view.fileView.form.*"
               xmlns:dictionary="dittner.gsa.view.fileView.file.dictionary.*"
               xmlns:notebook="dittner.gsa.view.fileView.file.notebook.*"
               xmlns:header="dittner.gsa.view.fileView.header.*"
               xmlns:common="cosmoLib.components.styleComponents.*">

    <fx:Script><![CDATA[
        import dittner.gsa.bootstrap.async.IAsyncOperation;
        import dittner.gsa.domain.fileSystem.FileType;
        import dittner.gsa.domain.fileSystem.GSAFile;
        import dittner.gsa.view.common.list.SelectableDataGroupEvent;
        import dittner.gsa.view.common.popup.SimplePopup;
        import dittner.gsa.view.common.utils.AppColors;

        import mx.collections.ArrayCollection;

        public function activate(file:GSAFile):void {
            header.file = file;
            dictionary.list.addEventListener(SelectableDataGroupEvent.SELECTED, noteSelected);
            notebook.list.addEventListener(SelectableDataGroupEvent.SELECTED, noteSelected);
            switch (file.header.fileType) {
                case FileType.DICTIONARY :
                    setCurrentState("dictionary");
                    dictionary.activate(file);
                    break;
                case FileType.NOTEBOOK :
                    setCurrentState("notebook");
                    notebook.activate(file);
                    break;
            }
        }

        public function refresh():void {
            if (dictionary.visible) (dictionary.list.dataProvider as ArrayCollection).refresh()
            else if (notebook.visible) (notebook.list.dataProvider as ArrayCollection).refresh()
        }

        public function clear():void {
            dictionary.list.removeEventListener(SelectableDataGroupEvent.SELECTED, noteSelected);
            notebook.list.removeEventListener(SelectableDataGroupEvent.SELECTED, noteSelected);
        }

        private function noteSelected(event:SelectableDataGroupEvent):void {
            dispatchEvent(event.clone());
        }

        public function showForm(file:GSAFile, toolAction:String):IAsyncOperation {
            var completeOp:IAsyncOperation = form.activate(file, toolAction);
            SimplePopup.show(form, true);
            return completeOp;
        }

        public function closeForm():void {
            SimplePopup.close();
        }
        ]]></fx:Script>

    <fx:Declarations>
        <form:FileBodyForm id="form"
                           verticalCenter="0" horizontalCenter="0"
                           width="50%" height="50%"/>
    </fx:Declarations>

    <view:states>
        <s:State name="notebook"/>
        <s:State name="dictionary"/>
    </view:states>

    <common:Background width="100%" height="100%"
                       color.notebook="{AppColors.DOC_NOTEBOOK}"
                       color.dictionary="{AppColors.DOC_DICTIONARY}"/>
    <common:Background width="40" height="100%" color="{AppColors.BG_DARK}"/>

    <s:VGroup height="100%" left="0" right="40"
              gap="0" horizontalAlign="right">
        <header:DocumentHeader id="header"
                               width="{width - 80}"/>

        <notebook:Notebook id="notebook"
                           includeInLayout="false" visible="false"
                           includeInLayout.notebook="true" visible.notebook="true"
                           width="100%" height="100%"/>

        <dictionary:Dictionary id="dictionary"
                               includeInLayout="false" visible="false"
                               includeInLayout.dictionary="true" visible.dictionary="true"
                               width="100%" height="100%"/>

    </s:VGroup>

    <toolbar:Toolbar id="toolbar"
                     width="40" right="0" height="100%"/>

</view:ViewBase>